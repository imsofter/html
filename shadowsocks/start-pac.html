<!DOCTYPE html> <html lang=zh-CN> <head> <meta charset=UTF-8> <title>浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理 | 阿超的博客</title> <meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"> <meta name=author content=阿超> <meta name=description content="Shadowsocks作为现在一种很流行的穿墙工具，以其轻量级、速度感人等优点深受广大网友热捧。与VP_N相比，他就像一把锋利的”瑞士军刀”，不用受制于“系统全局代理”模式的困扰，控制更加便捷，基于Socks5安全加密协议，防止GF*W通过分析流量特征从而干扰的问题。而又不像GoAgent这种集中式爬墙模式，一般不会出现全局封锁等现象。不管你是因为什么原因喜欢上Shadowsocks，我相信她一定有给你带来好的体验的方面。
　　在Shadowsocks里面，系统代理模式有两种，一种是“系统代理模式”，另一种是“PAC代理模式”，通常情况下我们会选择后者，今天这里给大家解析一下PAC模式的原理以及如何修改PAC文件、user-rule文件实现自动代理，希望大家可以通过本文更方面的“科学上网”。
什么是PAC　　代理自动配置（英语：Proxy auto-config，简称PAC）是一种网页浏览器技术，用于定义浏览器该如何自动选择适当的代理服务器来访问一个网址。一个PAC文件包含一个JavaScript形式的函数“FindProxyForURL(url, host)”。这个函数返回一个包含一个或多个访问规则的字符串。用户代理根据这些规则适用一个特定的代理其或者直接访问。当一个代理服务器无法响应的时候，多个访问规则提供了其他的后备访问方法。浏览器在访问其他页面以前，首先访问这个PAC文件。PAC文件中的URL可能是手工配置的，也可能是是通过网页的网络代理自发现协议（Web Proxy Autodiscovery Protocol）自动配置的。　　上面是从维基百科摘录的关于PAC的解释，我做了一个简单的图片解释什么是PAC："> <meta name=description content=Shadowsocks作为现在一种很流行的穿墙工具，以其轻量级、速度感人等优点深受广大网友热捧。与VP_N相比，他就像一把锋利的”瑞士军刀”，不用受制于“系统全局代理”模式的困扰，控制更加便捷，基于Socks5安全加密协议，防止GF*W通过分析流量特征从而干扰的问题。而又不像GoAgent这种集中式爬墙模式，一般不会出现全局封锁等现象。不管你是因为什么原因喜欢上Shadowsocks，我相信她一定> <meta property=og:type content=article> <meta property=og:title content=浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理> <meta property=og:url content=http://www.awolau.com/shadowsocks/start-pac.html> <meta property=og:site_name content=阿超的博客> <meta property=og:description content=Shadowsocks作为现在一种很流行的穿墙工具，以其轻量级、速度感人等优点深受广大网友热捧。与VP_N相比，他就像一把锋利的”瑞士军刀”，不用受制于“系统全局代理”模式的困扰，控制更加便捷，基于Socks5安全加密协议，防止GF*W通过分析流量特征从而干扰的问题。而又不像GoAgent这种集中式爬墙模式，一般不会出现全局封锁等现象。不管你是因为什么原因喜欢上Shadowsocks，我相信她一定> <meta property=og:image content=http://7villj.com1.z0.glb.clouddn.com/pac/pac-1.png> <meta property=og:image content=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac.png> <meta property=og:image content=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac2.png> <meta property=og:image content=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac3.png> <meta property=og:image content=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac4.png> <meta name=twitter:card content=summary> <meta name=twitter:title content=浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理> <meta name=twitter:description content=Shadowsocks作为现在一种很流行的穿墙工具，以其轻量级、速度感人等优点深受广大网友热捧。与VP_N相比，他就像一把锋利的”瑞士军刀”，不用受制于“系统全局代理”模式的困扰，控制更加便捷，基于Socks5安全加密协议，防止GF*W通过分析流量特征从而干扰的问题。而又不像GoAgent这种集中式爬墙模式，一般不会出现全局封锁等现象。不管你是因为什么原因喜欢上Shadowsocks，我相信她一定> <link rel=alternative href=/atom.xml title=阿超的博客 type=application/atom+xml> <link rel=icon href=/img/favicon.ico> <link rel=apple-touch-icon href=/img/jacman.jpg> <link rel=apple-touch-icon-precomposed href=/img/jacman.jpg> <link rel=stylesheet href=/css/style.css type=text/css>  <body> <header> <div> <div id=imglogo> <a href="/"><img src=/img/logo.svg alt=阿超的博客 title="阿超的博客"></a> </div> <div id=textlogo> <h1 class=site-name><a href="/" title=阿超的博客>阿超的博客</a></h1> <h2 class=blog-motto>分享学习收获</h2> </div> <div class=navbar><a class="navbutton navmobile" href=# title=菜单> </a></div> <nav class=animated> <ul> <ul> <li><a href="/">首页</a></li> <li><a href=/archives>归档</a></li> <li><a href=/about>关于</a></li> <li> <form class=search action=//google.com/search accept-charset=utf-8> <label>Search</label> <input type=search id=search name=q autocomplete=off maxlength=20 placeholder="搜索"> <input type=hidden name=q value=site:www.awolau.com> </form> </li> </ul> </ul></nav> </div> </header> <div id=container> <div id=main class=post itemscope itemprop=blogPost> <article itemprop=articleBody> <header class="article-info clearfix"> <h1 itemprop=name> <a href=/shadowsocks/start-pac.html title=浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理 itemprop=url>浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理</a> </h1> <p class=article-author>By <a href=http://www.awolau.com/about title=阿超 target=_blank itemprop=author>阿超</a> </p><p class=article-time> <time datetime=2015-08-09T05:14:11.000Z itemprop=datePublished> 发表于 2015-8-9</time> </p> </header> <div class=article-content> <div id=toc class=toc-article> <strong class=toc-title>文章目录</strong> <ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#什么是PAC><span class=toc-number>1.</span> <span class=toc-text>什么是PAC</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#PAC的优势><span class=toc-number>2.</span> <span class=toc-text>PAC的优势</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#PAC文件及user-rule文件的语法规则><span class=toc-number>3.</span> <span class=toc-text>PAC文件及user-rule文件的语法规则</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#1-_添加到pac-txt文件中><span class=toc-number>3.1.</span> <span class=toc-text>1. 添加到pac.txt文件中</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#2-_添加到user-rule-txt文件中><span class=toc-number>3.2.</span> <span class=toc-text>2. 添加到user-rule.txt文件中</span></a></li></ol></li></ol> </div> <p> Shadowsocks作为现在一种很流行的穿墙工具，以其轻量级、速度感人等优点深受广大网友热捧。与VP_N相比，他就像一把锋利的”瑞士军刀”，不用受制于“系统全局代理”模式的困扰，控制更加便捷，基于Socks5安全加密协议，防止GF*W通过分析流量特征从而干扰的问题。而又不像GoAgent这种集中式爬墙模式，一般不会出现全局封锁等现象。不管你是因为什么原因喜欢上Shadowsocks，我相信她一定有给你带来好的体验的方面。</p> <p> 在Shadowsocks里面，系统代理模式有两种，一种是“系统代理模式”，另一种是“PAC代理模式”，通常情况下我们会选择后者，今天这里给大家解析一下PAC模式的原理以及如何修改PAC文件、user-rule文件实现自动代理，希望大家可以通过本文更方面的“科学上网”。</p> <h1 id=什么是PAC>什么是PAC</h1><p> 代理自动配置（英语：Proxy auto-config，简称PAC）是一种网页浏览器技术，用于定义浏览器该如何自动选择适当的代理服务器来访问一个网址。<br>一个PAC文件包含一个JavaScript形式的函数“FindProxyForURL(url, host)”。这个函数返回一个包含一个或多个访问规则的字符串。用户代理根据这些规则适用一个特定的代理其或者直接访问。当一个代理服务器无法响应的时候，多个访问规则提供了其他的后备访问方法。浏览器在访问其他页面以前，首先访问这个PAC文件。PAC文件中的URL可能是手工配置的，也可能是是通过网页的网络代理自发现协议（Web Proxy Autodiscovery Protocol）自动配置的。<br> 上面是从维基百科摘录的关于PAC的解释，我做了一个简单的图片解释什么是PAC：<br><img src=http://7villj.com1.z0.glb.clouddn.com/pac/pac-1.png alt=PAC原理><br><a id=more></a><br> 简单的将，PAC就是一种配置，它能让你的浏览器只能判断哪些网站走代理，哪些不需要走代理。用过Shadowsocks的朋友应该会知道，<code>shadowsocks.exe</code>同级目录下有一个<code>pac.txt</code>文件，这正式我们本文刚刚所说的pac配置文件。<br><img src=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac.png alt=PAC文件><br> 打开<code>pac.txt</code>文件，可以看到如下内容<br><img src=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac2.png alt=PAC文件><br> 可以看到pac配置文件是用的JavaScript语法，里面有一个变量<code>rules</code>，是一个JSon数组格式的数据类型，数组里面存放的是各种URL的通配符，那么在pac模式下，如果当访问符合这个数组里面任意一个URL通配符的网址时，系统会走代理，反之直连。比如图中pac配置，如果访问<code>http://www.cloudflare.com/index.php</code>时，会走代理，而访问百度、新浪等国内网站则会选择直连方式。</p> <h1 id=PAC的优势>PAC的优势</h1><p>PAC自动代理属于智能判断模式，相比全局代理，它的优点有：</p> <ol> <li>不影响国内网站的访问速度，防止无意义的绕路</li> <li>节省Shadowsocks服务的流量，节省服务器资源</li> <li>控制方便</li> </ol> <h1 id=PAC文件及user-rule文件的语法规则>PAC文件及user-rule文件的语法规则</h1><p> 那么，当一个网站被墙，如何添加到PAC里面让其能够正常访问呢？在Shadowsocks里面，可以有如下两个方式：</p> <h2 id=1-_添加到pac-txt文件中>1. 添加到<code>pac.txt</code>文件中</h2><p>编辑<code>pac.txt</code>文件，模仿里面的一些URL通配符，再添加一个，例如<code>&quot;||ip138.com&quot;,</code>，注意不要忘记了<code>,</code>半角逗号，那么意思就是所有<code>ip138.com</code>域名下的网址都将走Shadowsocks代理，打开ip138可以看到IP已经变成Shadowsocks所用的国外代理了<br><img src=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac3.png alt=PAC文件></p> <h2 id=2-_添加到user-rule-txt文件中>2. 添加到<code>user-rule.txt</code>文件中</h2><p>编辑<code>user-rule.txt</code>文件，这里和<code>pac.txt</code>文件语法不完全相同，user-rule文件中，每一行表示一个URL通配符，但是通配符语法类似。例如添加一行<code>||ip138.com^</code>，然后记得右键小飞机-PAC-从GFWList更新本地PAC，打开ip138可以看到IP已经变成Shadowsocks所用的国外代理了<br><img src=http://7villj.com1.z0.glb.clouddn.com/pac/ss-pac4.png alt=user-rule文件><br>注意末尾不要忘记<code>^</code>符号，意思是要么在这个符号的地方结束，要么后面跟着?,/等符号。<br>自定义代理规则的设置语法与GFWlist相同，语法规则如下：</p> <ol> <li>通配符支持。比如<code>*.example.com/*</code>实际书写时可省略<code>*</code>， 如<code>.example.com/</code>， 和<code>*.example.com/*</code>效果一样</li> <li>正则表达式支持。以<code>\</code>开始和结束， 如 <code>\[\w]+:\/\/example.com\</code></li> <li>例外规则 <code>@@</code>，如 <code>@@*.example.com/*</code> 满足<code>@@</code>后规则的地址不使用代理</li> <li>匹配地址开始和结尾 <code>|</code>，如 <code>|http://example.com</code>、<code>example.com|</code>分别表示以<code>http://example.com</code>开始和以<code>example.com</code>结束的地址</li> <li><code>||</code> 标记，如 <code>||example.com</code> 则<code>http://example.com</code>、<code>https://example.com</code>、<code>ftp://example.com</code>等地址均满足条件</li> <li>注释 <code>!</code>。 如 <code>!我是注释</code></li> </ol> <p>更多user-rule.txt语法规则，可以参考AdBlockPlus过滤规则<a href=https://adblockplus.org/en/filter-cheatsheet target=_blank rel=nofollow>https://adblockplus.org/en/filter-cheatsheet</a></p> </div> <footer class="article-footer clearfix"> <div class=article-catetags> <div class=article-categories> <span></span> <a class=article-category-link href="/categories/shadowsocks/">shadowsocks</a> </div> <div class=article-tags> <span></span> <a href="/tags/pac/">pac</a><a href="/tags/pac文件修改/">pac文件修改</a><a href="/tags/shadowsocks/">shadowsocks</a><a href="/tags/user-rule/">user-rule</a> </div> </div> <div class=article-share id=share> <div data-url=http://www.awolau.com/shadowsocks/start-pac.html data-title="浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理 | 阿超的博客" data-tsina=null class="share clearfix"> </div> </div> </footer> </article> <nav class="article-nav clearfix"> <div class=next> <a href=/java/eclipse-maven-no-compiler-is-provided.html title="Eclipse中，No compiler is provided in this environment. Perhaps you are running on a JRE rather than a JDK? 问题的解决方案"> <strong>下一篇：</strong><br> <span>Eclipse中，No compiler is provided in this environment. Perhaps you are running on a JRE rather than a JDK? 问题的解决方案 </span> </a> </div> </nav> <section id=comments class=comment> <div class=ds-thread data-thread-key=shadowsocks/start-pac.html data-title=浅析PAC，教你动手修改你的PAC文件及user-rule文件实现自动代理 data-url=http://www.awolau.com/shadowsocks/start-pac.html></div> </section> </div> <div class=openaside><a class=navbutton href=# title=显示侧边栏></a></div> <div id=toc class=toc-aside> <strong class=toc-title>文章目录</strong> <ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#什么是PAC><span class=toc-number>1.</span> <span class=toc-text>什么是PAC</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#PAC的优势><span class=toc-number>2.</span> <span class=toc-text>PAC的优势</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#PAC文件及user-rule文件的语法规则><span class=toc-number>3.</span> <span class=toc-text>PAC文件及user-rule文件的语法规则</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#1-_添加到pac-txt文件中><span class=toc-number>3.1.</span> <span class=toc-text>1. 添加到pac.txt文件中</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#2-_添加到user-rule-txt文件中><span class=toc-number>3.2.</span> <span class=toc-text>2. 添加到user-rule.txt文件中</span></a></li></ol></li></ol> </div> <div id=asidepart> <div class=closeaside><a class=closebutton href=# title=隐藏侧边栏></a></div> <aside class=clearfix> <div class=categorieslist> <p class=asidetitle>分类</p> <ul> <li><a href="/categories/apache/" title=apache>apache<sup>2</sup></a></li> <li><a href="/categories/git/" title=git>git<sup>1</sup></a></li> <li><a href="/categories/hosts/" title=hosts>hosts<sup>1</sup></a></li> <li><a href="/categories/impression/" title=impression>impression<sup>1</sup></a></li> <li><a href="/categories/java/" title=java>java<sup>1</sup></a></li> <li><a href="/categories/linux/" title=linux>linux<sup>1</sup></a></li> <li><a href="/categories/markdown/" title=markdown>markdown<sup>2</sup></a></li> <li><a href="/categories/php/" title=php>php<sup>0</sup></a></li> <li><a href="/categories/shadowsocks/" title=shadowsocks>shadowsocks<sup>4</sup></a></li> <li><a href="/categories/vcf/" title=vcf>vcf<sup>1</sup></a></li> </ul> </div> <div class=tagslist> <p class=asidetitle>标签</p> <ul class=clearfix> <li><a href="/tags/shadowsocks/" title=shadowsocks>shadowsocks<sup>4</sup></a></li> <li><a href="/tags/科学上网/" title=科学上网>科学上网<sup>3</sup></a></li> <li><a href="/tags/google/" title=google>google<sup>3</sup></a></li> <li><a href="/tags/youtube/" title=youtube>youtube<sup>3</sup></a></li> <li><a href="/tags/facebook/" title=facebook>facebook<sup>3</sup></a></li> <li><a href="/tags/shadowsocks教程/" title=shadowsocks教程>shadowsocks教程<sup>2</sup></a></li> <li><a href="/tags/htaccess/" title=.htaccess>.htaccess<sup>2</sup></a></li> <li><a href="/tags/markdown/" title=markdown>markdown<sup>2</sup></a></li> <li><a href="/tags/markdown语法/" title=markdown语法>markdown语法<sup>2</sup></a></li> <li><a href="/tags/git/" title=git>git<sup>2</sup></a></li> <li><a href="/tags/apache/" title=apache>apache<sup>2</sup></a></li> <li><a href="/tags/shadowsocks-windows/" title="shadowsocks windows">shadowsocks windows<sup>1</sup></a></li> <li><a href="/tags/linux命令/" title=linux命令>linux命令<sup>1</sup></a></li> <li><a href="/tags/名片/" title=名片>名片<sup>1</sup></a></li> <li><a href="/tags/pac/" title=pac>pac<sup>1</sup></a></li> <li><a href="/tags/vcf/" title=vcf>vcf<sup>1</sup></a></li> <li><a href="/tags/user-rule/" title=user-rule>user-rule<sup>1</sup></a></li> <li><a href="/tags/shadowsocks-windows8/" title="shadowsocks windows8">shadowsocks windows8<sup>1</sup></a></li> <li><a href="/tags/pac文件修改/" title=pac文件修改>pac文件修改<sup>1</sup></a></li> <li><a href="/tags/vcf合并/" title=vcf合并>vcf合并<sup>1</sup></a></li> </ul> </div> <div class=weiboshow> <p class=asidetitle>新浪微博</p> <iframe width=100% height=550 class=share_self frameborder=0 scrolling=no src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1195294274&verifier=efeae95f&dpc=1"></iframe> </div> <div class=rsspart> <a href=/atom.xml target=_blank title=rss>RSS 订阅</a> </div> </aside> </div> </div> <footer><div id=footer> <div class=line> <span></span> <div class=author></div> </div> <section class=info> <p> Hello ,I&#39;m A Super in Google. <br> This is my blog,believe it or not.</p> </section> <div class=social-font class=clearfix> <a href=http://weibo.com/1195294274 target=_blank class=icon-weibo title=微博 rel="external nofollow"></a> <a href=https://github.com/chao591 target=_blank class=icon-github title=github rel="external nofollow"></a> <a href=mailto:840652591@qq.com target=_blank class=icon-email title="Email Me"></a> </div> <p class=copyright> <script type=text/javascript>var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F14ce12161668fc05d603993c60cc704f' type='text/javascript'%3E%3C/script%3E"));</script> <script type=text/javascript>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254396325'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1254396325%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script> Powered by <a href="http://zespia.tw/hexo/" target=_blank title=hexo rel="external nofollow">hexo</a> and Theme by <a href=https://github.com/chao591/cacman target=_blank title=Cacman rel="external nofollow">Cacman</a> © 2015 <a href=http://www.awolau.com/about target=_blank title=阿超>阿超</a> </p> <p class=copyright style="font-family:'Helvetica Neue', Helvetica, 'Microsoft YaHei', 'WenQuanYi Micro Hei', Arial, sans-serif;font-size: 13px"> <a href="http://www.miitbeian.gov.cn/" target=_blank rel="external nofollow">京ICP备15010677号-1</a> </p> </div> </footer> <div id=totop> <a title=返回顶部><img src="/img/scrollup.png"></a> </div> <script src=http://libs.baidu.com/jquery/2.1.1/jquery.min.js></script> <script type=text/javascript>var cacman_var = {};cacman_var.is_post=true;cacman_var.post_page_photo=true;cacman_var.duoshuo_shortname="awolau";cacman_var.post_toc_aside=true;</script> <script type=text/javascript>cacman_var.post_page_photo_fancybox=true;</script> <link rel=stylesheet href=/fancybox/jquery.fancybox.css media=screen type=text/css> <script src=/fancybox/jquery.fancybox.pack.js></script> <script src=/js/main.js></script> <!-- mathjax config similar to math.stackexchange -->  